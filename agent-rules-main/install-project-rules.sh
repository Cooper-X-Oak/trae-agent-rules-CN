#!/bin/bash
# Install Project Rules for Claude Code
# å®‰è£… Claude Code çš„é¡¹ç›®è§„åˆ™

echo "ðŸŽ¯ Installing Project Rules for Claude Code"
# æ‰“å°å¼€å§‹å®‰è£…çš„æç¤ºä¿¡æ¯ï¼Œä½¿ç”¨ emoji å¢žåŠ è§†è§‰æç¤º
echo "=========================================="
# æ‰“å°åˆ†éš”çº¿ï¼Œä¿æŒè¾“å‡ºæ•´æ´

// å°†æ£€æŸ¥ç›®å½•å­˜åœ¨çš„æ³¨é‡Šæ”¹ä¸ºä¸­æ–‡ï¼Œä¿æŒæ³¨é‡Šé£Žæ ¼ä¸€è‡´
# æ£€æŸ¥å½“å‰æ˜¯å¦åœ¨ agent-rules ç›®å½•ä¸‹è¿è¡Œ
if [ ! -d "project-rules" ]; then
    // å°†ç›®å½•æ£€æŸ¥åŽŸç†æ³¨é‡Šæ”¹ä¸ºä¸­æ–‡ï¼Œä¿æŒæ³¨é‡Šé£Žæ ¼ä¸€è‡´
    # [åŽŸç†] ä½¿ç”¨ -d å‚æ•°æ£€æŸ¥ project-rules ç›®å½•æ˜¯å¦å­˜åœ¨
    # [è®¾è®¡æ„å›¾] ç¡®ä¿è„šæœ¬åœ¨æ­£ç¡®çš„æ ¹ç›®å½•ä¸‹æ‰§è¡Œï¼Œå› ä¸ºåŽç»­é€»è¾‘ä¾èµ–ç›¸å¯¹è·¯å¾„
    echo "âŒ Error: project-rules directory not found"
    // å°†æ½œåœ¨é—®é¢˜æ³¨é‡Šæ”¹ä¸ºä¸­æ–‡ï¼Œä¿æŒæ³¨é‡Šé£Žæ ¼ä¸€è‡´
    # [æ½œåœ¨é—®é¢˜] å¦‚æžœç”¨æˆ·ä¿®æ”¹äº†ç›®å½•ç»“æž„ï¼Œè¿™é‡Œä¼šæŠ¥é”™ï¼Œéœ€è¦æç¤ºç”¨æˆ·åœ¨æ ¹ç›®å½•è¿è¡Œ
    echo "   Please run this from the agent-rules repository root"
    exit 1
    // å°†é€€å‡ºç æ³¨é‡Šæ”¹ä¸ºä¸­æ–‡ï¼Œä¿æŒæ³¨é‡Šé£Žæ ¼ä¸€è‡´
    # [é€€å‡ºç ] éžé›¶é€€å‡ºç è¡¨ç¤ºæ‰§è¡Œå¤±è´¥
fi

# Create Claude directory if it doesn't exist
// ä¸ºåˆ›å»ºç›®å½•æ·»åŠ ä¸­æ–‡æ³¨é‡Š
# å¦‚æžœ ~/.claude ç›®å½•ä¸å­˜åœ¨åˆ™åˆ›å»ºå®ƒ
mkdir -p ~/.claude
// å°†mkdiråŽŸç†è¯´æ˜Žæ³¨é‡Šæ”¹ä¸ºä¸­æ–‡ï¼Œä¿æŒæ³¨é‡Šé£Žæ ¼ä¸€è‡´
# [åŽŸç†] -p å‚æ•°ç¡®ä¿å¦‚æžœçˆ¶ç›®å½•ä¸å­˜åœ¨ä¹Ÿä¼šä¸€å¹¶åˆ›å»ºï¼Œä¸”ç›®å½•å·²å­˜åœ¨æ—¶ä¸ä¼šæŠ¥é”™

# Check if CLAUDE.md exists
// ä¸ºæ£€æŸ¥æ–‡ä»¶å­˜åœ¨æ€§æ·»åŠ ä¸­æ–‡æ³¨é‡Š
# æ£€æŸ¥ ~/.claude/CLAUDE.md æ–‡ä»¶æ˜¯å¦å­˜åœ¨
if [ -f ~/.claude/CLAUDE.md ]; then
    // å°†æ£€æŸ¥æ–‡ä»¶å­˜åœ¨æ€§åŽŸç†æ³¨é‡Šæ”¹ä¸ºä¸­æ–‡ï¼Œä¿æŒæ³¨é‡Šé£Žæ ¼ä¸€è‡´
    # [åŽŸç†] -f å‚æ•°ç”¨äºŽåˆ¤æ–­æ–‡ä»¶æ˜¯å¦å­˜åœ¨
    # [è®¾è®¡æ„å›¾] æ£€æŸ¥ç”¨æˆ·æ˜¯å¦å·²ç»é…ç½®äº† CLAUDE.mdï¼Œé¿å…é‡å¤æ·»åŠ 
    echo "ðŸ“ Found existing ~/.claude/CLAUDE.md"
    echo "   Adding import for project rules..."
    
    # Check if already imported
    // ä¸ºæ£€æŸ¥æ˜¯å¦å·²å¯¼å…¥é¡¹ç›®è§„åˆ™æ·»åŠ ä¸­æ–‡æ³¨é‡Š
    # æ£€æŸ¥æ˜¯å¦å·²ç»å¯¼å…¥äº†é¡¹ç›®è§„åˆ™ï¼Œé¿å…é‡å¤å¯¼å…¥
    if grep -q "@.*project-rules" ~/.claude/CLAUDE.md; then
        // å°†æ£€æŸ¥å¯¼å…¥è¯­å¥æ˜¯å¦å·²å­˜åœ¨åŽŸç†æ³¨é‡Šæ”¹ä¸ºä¸­æ–‡ï¼Œä¿æŒæ³¨é‡Šé£Žæ ¼ä¸€è‡´
        # [åŽŸç†] grep -q é™é»˜æœç´¢ï¼Œå¦‚æžœæ‰¾åˆ°åŒ¹é…é¡¹åˆ™è¿”å›ž 0ï¼ˆçœŸï¼‰
        # [è®¾è®¡æ„å›¾] æ£€æŸ¥å¯¼å…¥è¯­å¥æ˜¯å¦å·²å­˜åœ¨ï¼Œé¿å…é‡å¤æ·»åŠ 
        echo "âœ“ Project rules already imported"
    else
        // å°†æ·»åŠ å¯¼å…¥è¯­å¥çš„æ³¨é‡Šæ”¹ä¸ºä¸­æ–‡ï¼Œä¿æŒæ³¨é‡Šé£Žæ ¼ä¸€è‡´
        # [è®¾è®¡æ„å›¾] åœ¨æ–‡ä»¶æœ«å°¾è¿½åŠ å¯¼å…¥è¯­å¥ï¼Œç¡®ä¿åœ¨å¯åŠ¨ Claude Code æ—¶èƒ½åŠ è½½é¡¹ç›®è§„åˆ™
        echo "" >> ~/.claude/CLAUDE.md
        # æ·»åŠ ç©ºè¡Œï¼Œä¿æŒæ–‡ä»¶æ ¼å¼æ•´æ´
        echo "# Project Rules" >> ~/.claude/CLAUDE.md
        # æ·»åŠ æ³¨é‡Šæ ‡é¢˜
        echo "@$(pwd)/project-rules" >> ~/.claude/CLAUDE.md
        // å°†æ·»åŠ å¯¼å…¥è¯­å¥åŽŸç†æ³¨é‡Šæ”¹ä¸ºä¸­æ–‡ï¼Œä¿æŒæ³¨é‡Šé£Žæ ¼ä¸€è‡´
        # [åŽŸç†] $(pwd) èŽ·å–å½“å‰ç»å¯¹è·¯å¾„ï¼Œä½¿ç”¨ @ è¯­æ³•å¯¼å…¥è§„åˆ™ç›®å½•
        # [è®¾è®¡æ„å›¾] ä½¿ç”¨ç»å¯¹è·¯å¾„ç¡®ä¿åœ¨ä»»ä½•ä½ç½®å¯åŠ¨ Claude éƒ½èƒ½æ‰¾åˆ°è§„åˆ™
        echo "âœ“ Added project rules import"
    fi
else
    // ä¸ºåˆ›å»ºé…ç½®æ–‡ä»¶æ·»åŠ ä¸­æ–‡æ³¨é‡Š
    # å¦‚æžœé…ç½®æ–‡ä»¶ä¸å­˜åœ¨ï¼Œåˆ™åˆ›å»ºä¸€ä¸ªæ–°çš„
    echo "ðŸ“ Creating ~/.claude/CLAUDE.md with project rules import..."
    cat > ~/.claude/CLAUDE.md << EOF
# Claude Code User Memory
// è¿™æ˜¯ Claude Code çš„ç”¨æˆ·å†…å­˜æ–‡ä»¶ï¼Œç”¨äºŽå­˜å‚¨ä¸ªäººåå¥½å’Œè‡ªå®šä¹‰å‘½ä»¤
// æ­¤æ–‡ä»¶åŒ…å«ç”¨æˆ·åœ¨ Claude Code ä¸­è®¾ç½®çš„ä¸ªäººé…ç½®å’Œè‡ªå®šä¹‰æŒ‡ä»¤

# Project Rules
// è¿™æ˜¯é¡¹ç›®è§„åˆ™å¯¼å…¥è¯­å¥ï¼Œç”¨äºŽå¼•å…¥é¡¹ç›®ç‰¹å®šçš„è§„åˆ™
// æ­¤å¯¼å…¥è¯­å¥ç¡®ä¿åœ¨ä»»ä½•ä½ç½®å¯åŠ¨ Claude Code æ—¶éƒ½èƒ½åŠ è½½é¡¹ç›®è§„åˆ™
@$(pwd)/project-rules
EOF
    // å°†åˆ›å»ºæ–‡ä»¶åŽŸç†æ³¨é‡Šæ”¹ä¸ºä¸­æ–‡ï¼Œä¿æŒæ³¨é‡Šé£Žæ ¼ä¸€è‡´
    # [åŽŸç†] ä½¿ç”¨ Here Document (<< EOF) ä¸€æ¬¡æ€§å†™å…¥å¤šè¡Œå†…å®¹
    # [è®¾è®¡æ„å›¾] ä¸ºæ–°ç”¨æˆ·æä¾›ä¸€ä¸ªåŒ…å«åŸºæœ¬ç»“æž„å’Œè§„åˆ™å¯¼å…¥çš„åˆå§‹é…ç½®æ–‡ä»¶
    echo "âœ“ Created CLAUDE.md with project rules"
fi

echo ""
echo "âœ… Installation complete!"
// ä¸ºå®‰è£…å®Œæˆä¿¡æ¯æ·»åŠ ä¸­æ–‡æ³¨é‡Š
echo ""
// ä¸ºå¯ç”¨æ–œæ å‘½ä»¤åˆ—è¡¨çš„æ˜¾ç¤ºä»£ç æ·»åŠ ä¸­æ–‡æ³¨é‡Šï¼Œè¯´æ˜Žå‘½ä»¤åˆ—è¡¨çš„å±•ç¤ºæ„å›¾
echo "ðŸ“‹ å¯ç”¨æ–œæ å‘½ä»¤åˆ—è¡¨åœ¨ Claude Code ä¸­:"
echo ""
// å°†Git & GitHubéƒ¨åˆ†çš„è‹±æ–‡æ³¨é‡Šæ”¹ä¸ºä¸­æ–‡
echo "Git & GitHub:"
echo "  /commit             - åˆ›å»ºç¬¦åˆ conventional commit è§„èŒƒçš„æäº¤æ¶ˆæ¯å’Œè¡¨æƒ…ç¬¦å·"
echo "  /commit-fast        - ç”Ÿæˆ 3 ä¸ªæäº¤æ¶ˆæ¯å»ºè®®å¹¶è‡ªåŠ¨ä½¿ç”¨ç¬¬ä¸€ä¸ª"
echo "  /bug-fix            - ä»Žé—®é¢˜åˆ›å»ºåˆ°æ‹‰å–è¯·æ±‚çš„ streamlined bug ä¿®å¤å·¥ä½œæµç¨‹"
echo "  /pr-review          - ä»Žå¤šä¸ªè§’åº¦å…¨é¢å®¡æŸ¥æ‹‰å–è¯·æ±‚"
echo "  /analyze-issue      - èŽ·å– GitHub é—®é¢˜è¯¦æƒ…å¹¶åˆ›å»ºå®žçŽ°è§„èŒƒ"
echo ""
// ä¸ºä»£ç è´¨é‡æ£€æŸ¥å‘½ä»¤æ·»åŠ ä¸­æ–‡æ³¨é‡Š
echo "Code Quality:"
echo "  /check              - æ‰§è¡Œå…¨é¢çš„ä»£ç è´¨é‡å’Œå®‰å…¨æ£€æŸ¥"
echo "  /clean              - ä¿®å¤æ•´ä¸ªä»£ç åº“ä¸­çš„æ‰€æœ‰ä»£ç æ ¼å¼åŒ–å’Œè´¨é‡é—®é¢˜"
// å°†ä»£ç åˆ†æžå‘½ä»¤æ³¨é‡Šæ”¹ä¸ºä¸­æ–‡ï¼Œä¿æŒæ³¨é‡Šé£Žæ ¼ä¸€è‡´
echo "  /code-analysis      - æ‰§è¡Œé«˜çº§ä»£ç åˆ†æžï¼Œæä¾›å¤šç§æ£€æŸ¥é€‰é¡¹"
echo ""
// å°†æ–‡æ¡£å‘½ä»¤éƒ¨åˆ†æ³¨é‡Šæ”¹ä¸ºä¸­æ–‡ï¼Œä¿æŒæ³¨é‡Šé£Žæ ¼ä¸€è‡´
echo "Documentation:"
echo "  /add-to-changelog   - æ›´æ–°é¡¹ç›®çš„ CHANGELOG.md æ–‡ä»¶ï¼Œæ·»åŠ æ–°çš„å˜æ›´è®°å½•"
echo "  /create-docs        - åˆ›å»ºç»„ä»¶æˆ–åŠŸèƒ½çš„å…¨é¢æ–‡æ¡£"
echo "  /mermaid            - ç”Ÿæˆ Mermaid å›¾è¡¨ï¼Œå¯è§†åŒ–ä»£ç ç»“æž„"
echo ""
// å°†å¼€å‘å·¥ä½œæµå‘½ä»¤æè¿°æ³¨é‡Šæ”¹ä¸ºä¸­æ–‡ï¼Œä¿æŒæ³¨é‡Šé£Žæ ¼ä¸€è‡´
echo "å¼€å‘å·¥ä½œæµ:"
echo "  /implement-task     - æ–¹æ³•icallyè§„åˆ’ä»»åŠ¡å®žçŽ°ï¼Œç¡®ä¿è´¨é‡"
echo "  /context-prime      - ä¸º Claude æä¾›å…¨é¢çš„é¡¹ç›®ç†è§£ï¼Œæå‡ç”Ÿæˆè´¨é‡"
echo "  /five               - ä½¿ç”¨ Five Whys æ ¹å› åˆ†æžç†è§£é—®é¢˜"
echo ""
// å°†è‡ªåŠ¨åŒ–ä¸Žå…ƒå‘½ä»¤éƒ¨åˆ†çš„è‹±æ–‡æ³¨é‡Šæ”¹ä¸ºä¸­æ–‡
echo "è‡ªåŠ¨åŒ–ä¸Žå…ƒå‘½ä»¤:"
echo "  /create-command     - å¼•å¯¼åˆ›å»ºæ–°çš„è‡ªå®šä¹‰ Claude å‘½ä»¤"
echo "  /continuous-improvement - ç³»ç»Ÿæ–¹æ³•æ”¹è¿› AI åŠ©æ‰‹è§„åˆ™"
echo "  /safari-automation  - è‡ªåŠ¨åŒ– Safari äº¤äº’ï¼Œç”¨äºŽ Web UI æµ‹è¯•"
echo "  /screenshot-automation - AppleScript æ¨¡å¼ï¼Œç”¨äºŽè‡ªåŠ¨æˆªå›¾"
echo ""
// å°†ç”¨æˆ·æŒ‡å¯¼ä¿¡æ¯çš„è‹±æ–‡æ³¨é‡Šæ”¹ä¸ºä¸­æ–‡
echo "è¦ä½¿ç”¨: è¾“å…¥ '/' åŽè·Ÿå‘½ä»¤åç§°åœ¨ Claude Code ä¸­"
// å°†ç”¨æˆ·æŒ‡å¯¼ä¿¡æ¯çš„è‹±æ–‡æ³¨é‡Šæ”¹ä¸ºä¸­æ–‡
echo "è¦ä½¿ç”¨: è¾“å…¥ '/' åŽè·Ÿå‘½ä»¤åç§°åœ¨ Claude Code ä¸­"
